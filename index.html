<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Calculator: House vs. Bitcoin vs Term Deposit</title>
   <style>
    :root {
        --primary-color: #3498db;
        --secondary-color: #2c3e50;
        --background-color: #f4f4f4;
        --card-background: #ffffff;
        --text-color: #333333;
    }
    body {
        font-family: 'Arial', sans-serif;
        line-height: 1.6;
        color: var(--text-color);
        background-color: var(--background-color);
        margin: 0;
        padding: 20px;
    }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
    }
    #aboutCard {
        width: 100%;
        margin-bottom: 20px;
    }
    .grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }
    .card {
        background-color: var(--card-background);
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
        width: 100%;
        box-sizing: border-box;
    }
    .general-and-term, #houseCard, #bitcoinCard {
        height: auto;
    }
    .calculate-button-container {
        width: 100%;
        text-align: center;
        margin: 20px 0;
    }
    #calculateButton {
        width: 100%;
        max-width: 300px;
        margin: 0 auto;
        padding: 15px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 18px;
    }
    #calculateButton:hover {
        background-color: #2980b9;
    }
    #resultsCard {
        width: 100%;
        margin-top: 20px;
        clear: both;
    }
    .results {
        opacity: 0;
        transition: opacity 0.5s ease;
    }
    .results.show {
        opacity: 1;
    }
    .input-group {
        margin-bottom: 15px;
        width: 100%;
    }
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    input[type="range"] {
        -webkit-appearance: none;
        width: 100%;
        background: transparent;
        padding: 0;
        margin-bottom: 5px;
    }
    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        background: var(--primary-color);
        cursor: pointer;
        border-radius: 50%;
        margin-top: -8px;
    }
    input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        background: var(--primary-color);
        cursor: pointer;
        border-radius: 50%;
        border: none;
    }
    input[type="range"]::-webkit-slider-runnable-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        background: #ddd;
        border-radius: 2px;
    }
    input[type="range"]::-moz-range-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        background: #ddd;
        border-radius: 2px;
    }
    input[type="range"]:focus {
        outline: none;
    }
    input[type="range"]:focus::-webkit-slider-thumb {
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.5);
    }
    input[type="range"]:focus::-moz-range-thumb {
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.5);
    }
    input[type="checkbox"] {
        width: auto;
        margin-right: 10px;
    }
    input[type="number"] {
        -moz-appearance: textfield;
        appearance: textfield;
        margin: 0; 
        border: 1px solid #ddd;
        padding: 5px;
        border-radius: 4px;
        width: 100%;
        box-sizing: border-box;
    }
    input[type="number"]::-webkit-inner-spin-button, 
    input[type="number"]::-webkit-outer-spin-button { 
        -webkit-appearance: none; 
        margin: 0; 
    }
    input[type="number"]:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        text-align: left;
        padding: 12px;
        border-bottom: 1px solid #ddd;
    }
    th {
        background-color: var(--primary-color);
        color: white;
    }
    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    .results-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: space-between;
    }
    .result-card, .comparison-card {
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
        width: calc(50% - 10px);
    }
    .comparison-card {
        width: 100%;
    }
    .result-card h3, .comparison-card h3 {
        margin-top: 0;
        color: #2c3e50;
    }
    .comparison-table {
        font-size: 0.9em;
    }
    .card.full-width {
        grid-column: 1 / -1;
    }
    @media (max-width: 1200px) {
        .grid-container {
            grid-template-columns: 1fr;
        }
    }
</style>
</head>
<body>
    <div class="container">
        <h1>Investment Calculator: House vs. Bitcoin vs Term Deposit</h1>
        
    <div class="card full-width" id="aboutCard">
        <h2>About This Tool</h2>
        <p>Welcome to our Investment Strategy Comparison Calculator. This tool is designed to help you visualise potential outcomes of different investment strategies over time. It compares the following investment scenarios:</p>
        <ol>
            <li>Purchasing a house with a mortgage</li>
            <li>Investing in Bitcoin while renting accommodation</li>
            <li>Investing in a Term Deposit</li>
            <li>Using a loan to invest in Bitcoin (optional scenario)</li>
        </ol>
        <h3>Key Features and Assumptions</h3>
        <ul>
            <li>The calculator uses a single initial investment amount and term for all scenarios (except the optional Loan4Bitcoin).</li>
            <li>It factors in inflation for costs and some investment returns.</li>
            <li>Capital gains tax can be optionally applied to profits.</li>
            <li>The House scenario assumes a fixed mortgage rate, includes annual costs (insurance, rates, maintenance), and applies a user-defined appreciation rate.</li>
            <li>The Bitcoin scenario assumes a lump sum investment, includes rental costs, and treats Bitcoin as inflation-resistant.</li>
            <li>The Term Deposit scenario uses a fixed interest rate and applies annual tax on earnings.</li>
            <li>The optional Loan4Bitcoin scenario allows you to explore borrowing to invest in Bitcoin.</li>
        </ul>
        <h3>Important Notes for Users</h3>
        <ol>
            <li>This is a comparative tool to help visualise potential outcomes. It is not a prediction of future performance.</li>
            <li>The results are based on your inputs and our assumptions. Real-world factors like market volatility, interest rate changes, or new regulations are not accounted for.</li>
            <li>The calculator assumes consistent growth rates and doesn't factor in potential market crashes or booms.</li>
            <li>The Bitcoin scenario assumes Bitcoin maintains its value against inflation, which is a significant assumption.</li>
            <li>The house scenario doesn't account for potential rental income if the property is an investment property.</li>
            <li>You can adjust inputs using sliders or direct entry for easy comparison of different scenarios.</li>
            <li>We provide CAGR (Compound Annual Growth Rate) spread results for the House and Bitcoin scenarios to show potential variance.</li>
        </ol>
        <p><strong>Remember:</strong> This calculator provides a simplified model of complex financial scenarios. It's crucial to consult with financial professionals before making any investment decisions. While we strive for accuracy, this tool should be used for educational and comparative purposes only.</p>
		<ol>
		<li> Inflation affects all costs - insurance, rates and rent. </li>
		<li> Inflation affects end purchasing power of House and Term deposit, but does not affect Bitcoins end purchasing power as Bitcoin is DEFLATIONARY and has limited supply </li>
		<li> <strong>Bitcoins current Compounded annual growth rate is around 62% over the last 10 years</strong>, 48% over the last 5 years (https://www.calculate.co.nz/cagr-calculator.php), this is not expected to continue at this rate, but it is impossible to predict, this is why in the calculator there are options for choosing the CAGR of the House and Bitcoin.</li>
		<li> You have to believe in Bitcoin to believe this calculator - so do your homework.</li>
		<li> <strong>Read the Bitcoin Whitepaper</strong>: https://bitcoin.org/bitcoin.pdf.</li>
		<li> Ask yourself, "What is money?" </li>
		<li> Watch and listen to people who have been thinking about this deeply. </li>
		<ol>
		<li> Lyn Alden - Macroeconomist + Author - e.g https://www.youtube.com/watch?v=jk_HWmmwiAs </li>
		<li> Michael Saylor - CEO Microstrategy - e.g https://www.youtube.com/watch?v=YjxhWV_Ha4g </li>
		<li> Jack Mallers - CEO Strike - e.g https://www.youtube.com/watch?v=pCYeq6R5JcU </li>
		<li> Resistance money Authors - https://www.youtube.com/watch?v=OtEp9lZKWvA </li>
		</ol>
		</ol>
                <p>You can choose which scenarios to calculate by checking the boxes below:</p>
                <div class="input-group">
                    <input type="checkbox" id="houseScenario" checked>
                    <label for="houseScenario">House Purchase Scenario</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="bitcoinScenario" checked>
                    <label for="bitcoinScenario">Bitcoin Investment Scenario</label>
                </div>
                <div class="input-group">
                    <input type="checkbox" id="termDepositScenario" checked>
                    <label for="termDepositScenario">Term Deposit Scenario</label>
                </div>
            </div>

             
        <div class="grid-container">
            <div class="card general-and-term">
                <div class="general-settings">
                    <h2>General (Inflation and Tax)</h2>
                    <div class="input-group">
                        <label for="inflationRate">Annual Inflation Rate (%):</label>
                        <input type="range" id="inflationRateSlider" min="0" max="10" step="0.1" value="2">
                        <input type="number" id="inflationRate" value="2" step="0.1">
                    </div>
                    <div class="input-group">
                        <input type="checkbox" id="applyTax" checked>
                        <label for="applyTax">Apply Capital Gains Tax</label>
                    </div>
                    <div class="input-group">
                        <label for="capitalGainsTax">Capital Gains Tax Rate (%):</label>
                        <input type="range" id="capitalGainsTaxSlider" min="0" max="50" step="0.1" value="15">
                        <input type="number" id="capitalGainsTax" value="15" step="0.1">
                    </div>
                </div>
                <div class="term-deposit-settings">
                    <h2>Term Deposit Scenario</h2>
                    <div class="input-group">
                        <label for="termDepositInitialInvestment">Initial Investment (NZD):</label>
                        <input type="range" id="termDepositInitialInvestmentSlider" min="1000" max="1000000" step="1000" value="100000">
                        <input type="number" id="termDepositInitialInvestment" value="100000">
                    </div>
                    <div class="input-group">
                        <label for="termDepositTerm">Investment Term (years):</label>
                        <input type="range" id="termDepositTermSlider" min="1" max="30" step="1" value="5">
                        <input type="number" id="termDepositTerm" value="5">
                    </div>
                    <div class="input-group">
                        <label for="termDepositRate">Term Deposit Interest Rate (%):</label>
                        <input type="range" id="termDepositRateSlider" min="0" max="10" step="0.1" value="3">
                        <input type="number" id="termDepositRate" value="3" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="termDepositTaxRate">Term Deposit Tax Rate (%):</label>
                        <input type="range" id="termDepositTaxRateSlider" min="0" max="50" step="0.1" value="33">
                        <input type="number" id="termDepositTaxRate" value="33" step="0.1">
                    </div>
                </div>
            </div>

            <div class="card" id="houseCard">
        <h2>House Purchase Scenario</h2>
      <div class="input-group">
    <label for="houseInitialInvestment">Initial House Investment (NZD):</label>
    <input type="range" id="houseInitialInvestmentSlider" min="100000" max="1000000" step="10000" value="300000">
    <input type="number" id="houseInitialInvestment" value="300000">
</div>
        <div class="input-group">
            <label for="houseInvestmentTerm">House Investment Term (years):</label>
            <input type="range" id="houseInvestmentTermSlider" min="10" max="30" step="1" value="30">
            <input type="number" id="houseInvestmentTerm" value="30">
        </div>
                <div class="input-group">
                    <label for="houseValue">Total House Value (NZD):</label>
                    <input type="range" id="houseValueSlider" min="500000" max="3000000" step="50000" value="1500000">
                    <input type="number" id="houseValue" value="1200000">
                </div>
                <div class="input-group">
                    <label for="mortgageRate">Mortgage Interest Rate (%):</label>
                    <input type="range" id="mortgageRateSlider" min="1" max="10" step="0.1" value="5">
                    <input type="number" id="mortgageRate" value="5" step="0.1">
                </div>
                <div class="input-group">
                    <label for="annualInsurance">Annual House Insurance (NZD):</label>
                    <input type="range" id="annualInsuranceSlider" min="1000" max="10000" step="100" value="3000">
                    <input type="number" id="annualInsurance" value="3000">
                </div>
                <div class="input-group">
                    <label for="annualRates">Annual House Rates (NZD):</label>
                    <input type="range" id="annualRatesSlider" min="1000" max="10000" step="100" value="2000">
                    <input type="number" id="annualRates" value="2000">
                </div>
                <div class="input-group">
                    <label for="annualMaintenance">Annual House Maintenance (% of house value):</label>
                    <input type="range" id="annualMaintenanceSlider" min="0.1" max="5" step="0.1" value="1">
                    <input type="number" id="annualMaintenance" value="0.5" step="0.1">
                </div>
	    <div class="input-group">
            <label for="houseCagr">House CAGR (%):</label>
            <input type="range" id="houseCagrSlider" min="0" max="20" step="0.1" value="5">
            <input type="number" id="houseCagr" value="4" step="0.1">
        </div>
    </div>
<div class="card" id="bitcoinCard">
                <h2>Bitcoin & Rent Scenario</h2>
                <div class="input-group">
                    <label for="bitcoinInitialInvestment">Initial Bitcoin Investment (NZD):</label>
                    <input type="range" id="bitcoinInitialInvestmentSlider" min="0" max="1000000" step="1000" value="100000">
                    <input type="number" id="bitcoinInitialInvestment" value="100000">
                </div>
                <div class="input-group">
                    <label for="bitcoinInvestmentTerm">Bitcoin Investment Term (years):</label>
                    <input type="range" id="bitcoinInvestmentTermSlider" min="1" max="30" step="1" value="10">
                    <input type="number" id="bitcoinInvestmentTerm" value="10">
                </div>
                <div class="input-group">
                    <label for="bitcoinInvestmentType">Bitcoin Investment Type:</label>
                    <select id="bitcoinInvestmentType">
                        <option value="lumpsum">Lump Sum</option>
                        <option value="dca">Dollar-Cost Averaging (DCA)</option>
                    </select>
                </div>
		<div id="lumpsumInputs">
		</div>
                <div id="dcaInputs" style="display:none;">
                    <div class="input-group">
                        <label for="dcaAmount">DCA Amount (NZD):</label>
                        <input type="range" id="dcaAmountSlider" min="10" max="10000" step="10" value="1000">
                        <input type="number" id="dcaAmount" value="1000">
                    </div>
                    <div class="input-group">
                        <label for="dcaFrequency">DCA Frequency:</label>
                        <select id="dcaFrequency">
                            <option value="weekly">Weekly</option>
                            <option value="fortnightly">Fortnightly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="dcaTerm">DCA Term (years):</label>
                        <input type="range" id="dcaTermSlider" min="1" max="30" step="1" value="5">
                        <input type="number" id="dcaTerm" value="5">
                    </div>
                </div>
    <div class="input-group">
        <label for="bitcoinPrice">Current Bitcoin Price (NZD):</label>
        <input type="range" id="bitcoinPriceSlider" min="10000" max="200000" step="1000" value="100000">
        <input type="number" id="bitcoinPrice" value="100000">
    </div>
    <div class="input-group">
        <label for="weeklyRent">Weekly Rent (NZD):</label>
        <input type="range" id="weeklyRentSlider" min="500" max="2000" step="50" value="1000">
        <input type="number" id="weeklyRent" value="1000">
    </div>
    <div class="input-group">
        <label for="bitcoinCagr">Bitcoin CAGR (%):</label>
        <input type="range" id="bitcoinCagrSlider" min="0" max="100" step="0.1" value="15">
        <input type="number" id="bitcoinCagr" value="10" step="0.1">
	<div><p><p>CAGR (Compounded Annual Growth Rate) represents the year-over-year growth rate of an investment over a specified time period.</p></div>
    </div>
              <div id="loan4bitcoinCard">
                    <h3>Loan4Bitcoin Scenario</h3>
                    <div class="input-group">
                        <input type="checkbox" id="loan4bitcoinScenario">
                        <label for="loan4bitcoinScenario">Include Loan4Bitcoin Scenario</label>
                    </div>
                    <div id="loan4bitcoinInputs" style="display: none;">
                    <div class="input-group">
                        <label for="bitcoinLoanAmount">Bitcoin Loan Amount (NZD):</label>
                        <input type="range" id="bitcoinLoanAmountSlider" min="0" max="1000000" step="10000" value="100000">
                        <input type="number" id="bitcoinLoanAmount" value="100000">
                    </div>
                    <div class="input-group">
                        <label for="bitcoinLoanRate">Bitcoin Loan Interest Rate (%):</label>
                        <input type="range" id="bitcoinLoanRateSlider" min="1" max="20" step="0.1" value="5">
                        <input type="number" id="bitcoinLoanRate" value="5" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="bitcoinLoanTerm">Bitcoin Loan Term (years):</label>
                        <input type="range" id="bitcoinLoanTermSlider" min="1" max="30" step="1" value="5">
                        <input type="number" id="bitcoinLoanTerm" value="5">
                    </div>
                </div>
            </div>
        </div>

      
<div class="calculate-button-container">
    <button id="calculateButton">Calculate</button>
</div>

<div class="card full-width id="resultsCard">
    <h2>Results</h2>
    <div id="results"></div>
</div>
</div>

    <script>
function formatNumber(number) {
    return number.toLocaleString('en-NZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function formatCurrency(number) {
    return '$' + formatNumber(number);
}

function formatPercentage(number) {
    return (number * 100).toFixed(2) + '%';
}

function calculateTaxImplications(profit, taxRate) {
    const applyTax = document.getElementById('applyTax').checked;
    return applyTax ? Math.max(0, profit * taxRate) : 0;
}

function syncInputs(sliderId, inputId) {
    const slider = document.getElementById(sliderId);
    const input = document.getElementById(inputId);
    if (slider && input) {
        slider.addEventListener('input', () => {
            input.value = slider.value;
            calculate();
        });
        input.addEventListener('change', () => {
            slider.value = input.value;
            calculate();
        });
    }
}

function calculateBitcoinInvestment(initialInvestment, bitcoinPrice, bitcoinCagr, years, weeklyRent, inflationRate, capitalGainsTaxRate, isDCA, dcaAmount, dcaFrequency, dcaTerm) {
        let bitcoinsPurchased = 0;
        let totalInvested = 0;

        if (isDCA) {
            const frequencyMultiplier = 
                dcaFrequency === 'weekly' ? 52 : 
                dcaFrequency === 'fortnightly' ? 26 : 12; // monthly
            const periodsPerYear = frequencyMultiplier;
            const totalPeriods = Math.min(dcaTerm, years) * periodsPerYear;

            for (let i = 0; i < totalPeriods; i++) {
                const currentPrice = bitcoinPrice * Math.pow(1 + bitcoinCagr, i / periodsPerYear);
                bitcoinsPurchased += dcaAmount / currentPrice;
                totalInvested += dcaAmount;
            }
          bitcoinsPurchased += initialInvestment / bitcoinPrice;
            totalInvested += initialInvestment;
        } else {
            bitcoinsPurchased = initialInvestment / bitcoinPrice;
            totalInvested = initialInvestment;
        }
const futureValue = bitcoinsPurchased * bitcoinPrice * Math.pow(1 + bitcoinCagr, years);
        let totalRentCost = weeklyRent * 52 * ((Math.pow(1 + inflationRate, years) - 1) / inflationRate);
        
        const capitalGain = futureValue - totalInvested;
        const capitalGainsTax = calculateTaxImplications(capitalGain, capitalGainsTaxRate);

        const nominalProfit = futureValue - totalInvested - totalRentCost - capitalGainsTax;
        const realProfit = nominalProfit; // Bitcoin is considered inflation-resistant

        return {
            bitcoinsPurchased,
            futureValue,
            totalInvested,
            totalRentCost,
            capitalGainsTax,
            nominalProfit,
            realProfit
        };
    }

function calculateHouseInvestment(deposit, houseValue, mortgageRate, mortgageTerm, annualInsurance, annualRates, annualMaintenance, inflationRate, capitalGainsTaxRate, houseCagr) {
    console.log("Inputs:", { deposit, houseValue, mortgageRate, mortgageTerm, annualInsurance, annualRates, annualMaintenance, inflationRate, capitalGainsTaxRate, houseCagr });

    const mortgageAmount = houseValue - deposit;
    const monthlyMortgageRate = mortgageRate / 12;
    const numberOfPayments = mortgageTerm * 12;

    const monthlyMortgage = mortgageAmount * (monthlyMortgageRate * Math.pow(1 + monthlyMortgageRate, numberOfPayments)) / (Math.pow(1 + monthlyMortgageRate, numberOfPayments) - 1);
    const totalMortgageCost = monthlyMortgage * numberOfPayments;

    let totalInsurance = 0;
    let totalRates = 0;
    let totalMaintenance = 0;
    let presentValueOfCosts = 0;

    for (let year = 0; year < mortgageTerm; year++) {
        totalInsurance += annualInsurance * Math.pow(1 + inflationRate, year);
        totalRates += annualRates * Math.pow(1 + inflationRate, year);
        totalMaintenance += houseValue * annualMaintenance * Math.pow(1 + inflationRate, year);
        
        // NEW: Calculate present value of costs
        presentValueOfCosts += (annualInsurance + annualRates + (houseValue * annualMaintenance)) / Math.pow(1 + inflationRate, year);
    }

    const finalHouseValue = houseValue * Math.pow(1 + houseCagr, mortgageTerm);
    const realFinalHouseValue = finalHouseValue / Math.pow(1 + inflationRate, mortgageTerm);

    const totalHouseCosts = totalMortgageCost + totalInsurance + totalRates + totalMaintenance;
    const realTotalHouseCosts = totalMortgageCost + presentValueOfCosts;

    const capitalGain = finalHouseValue - houseValue;
    const capitalGainsTax = calculateTaxImplications(capitalGain, capitalGainsTaxRate);

    const nominalNetProfit = finalHouseValue - totalHouseCosts - deposit - capitalGainsTax;
    // CHANGED: Update real net profit calculation
    const realNetProfit = realFinalHouseValue - realTotalHouseCosts - deposit - (capitalGainsTax / Math.pow(1 + inflationRate, mortgageTerm));

    console.log("Calculated values:", {
        mortgageAmount,
        monthlyMortgage,
        totalMortgageCost,
        totalInsurance,
        totalRates,
        totalMaintenance,
        finalHouseValue,
        realFinalHouseValue,
        totalHouseCosts,
        realTotalHouseCosts, // NEW: Log this
        capitalGain,
        capitalGainsTax,
        nominalNetProfit,
        realNetProfit
    });

    return {
        monthlyMortgage,
        totalMortgageCost,
        totalInsurance,
        totalRates,
        totalMaintenance,
        totalHouseCosts,
        finalHouseValue,
        realFinalHouseValue,
        capitalGainsTax,
        nominalNetProfit,
        realNetProfit
    };
}

function calculateTermDeposit(initialInvestment, interestRate, taxRate, years, inflationRate) {
    let balance = initialInvestment;
    let totalInterestEarned = 0;
    let totalTaxPaid = 0;

    for (let year = 0; year < years; year++) {
        const interestEarned = balance * interestRate;
        const taxPaid = interestEarned * taxRate;
        
        totalInterestEarned += interestEarned;
        totalTaxPaid += taxPaid;
        
        balance += interestEarned - taxPaid;
    }

    const nominalProfit = balance - initialInvestment;
    const realProfit = nominalProfit / Math.pow(1 + inflationRate, years);

    return {
        finalBalance: balance,
        totalInterestEarned,
        totalTaxPaid,
        nominalProfit,
        realProfit
    };
}
function calculateLoan4Bitcoin(loanAmount, bitcoinPrice, cagr, loanTerm, loanRate, inflationRate, capitalGainsTaxRate) {
    const bitcoinsPurchased = loanAmount / bitcoinPrice;
    const futureValue = bitcoinsPurchased * bitcoinPrice * Math.pow(1 + cagr, loanTerm);
    const monthlyPayment = (loanAmount * (loanRate / 12 / 100) * Math.pow(1 + loanRate / 12 / 100, loanTerm * 12)) / (Math.pow(1 + loanRate / 12 / 100, loanTerm * 12) - 1);
    const totalLoanCost = monthlyPayment * loanTerm * 12;
    
    const capitalGain = futureValue - loanAmount;
    const capitalGainsTax = calculateTaxImplications(capitalGain, capitalGainsTaxRate);

    const profit = futureValue - totalLoanCost - capitalGainsTax;

    return {
        bitcoinsPurchased,
        futureValue,
        totalLoanCost,
        capitalGainsTax,
        profit
    };
}

function generateComparisonTable(results) {
    let comparisonHtml = `
        <div class="comparison-card">
            <h3>Investment Comparison</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Initial Investment</th>
                        <th>Final Value</th>
                        <th>Total Costs</th>
                        <th>Nominal Profit</th>
                        <th>Real Profit</th>
                        <th>Return on Investment (Real)</th>
                    </tr>
                </thead>
                <tbody>
    `;

    for (const [scenario, data] of Object.entries(results)) {
        const roi = (data.realProfit / data.initialInvestment);
        comparisonHtml += `
            <tr>
                <td>${scenario}</td>
                <td>${formatCurrency(data.initialInvestment)}</td>
                <td>${formatCurrency(data.finalValue)}</td>
                <td>${formatCurrency(data.totalCosts)}</td>
                <td>${formatCurrency(data.nominalProfit)}</td>
                <td>${formatCurrency(data.realProfit)}</td>
                <td>${formatPercentage(roi)}</td>
            </tr>
        `;
    }

    comparisonHtml += `
                </tbody>
            </table>
        </div>
    `;

    return comparisonHtml;
}

 function getElementValue(id, defaultValue = '0') {
    const element = document.getElementById(id);
    if (!element) {
        console.warn(`Element with id '${id}' not found. Using default value: ${defaultValue}`);
        return defaultValue;
    }
    return element.value || defaultValue;
}

function parseFloatSafe(value, id, defaultValue = 0) {
    const parsed = parseFloat(value);
    if (isNaN(parsed)) {
        console.warn(`Invalid numeric value for '${id}': ${value}. Using default value: ${defaultValue}`);
        return defaultValue;
    }
    return parsed;
}


function calculate() {
    console.log('Starting calculation...');

    try {
        // Helper function to safely get and parse element values
        function getAndParseValue(id, defaultValue, isPercentage = false) {
            const element = document.getElementById(id);
            if (!element) {
                console.warn(`Element with id '${id}' not found. Using default value: ${defaultValue}`);
                return isPercentage ? defaultValue / 100 : defaultValue;
            }
            const value = parseFloat(element.value);
            if (isNaN(value)) {
                console.warn(`Invalid value for '${id}': ${element.value}. Using default value: ${defaultValue}`);
                return isPercentage ? defaultValue / 100 : defaultValue;
            }
            return isPercentage ? value / 100 : value;
        }

        const inflationRate = getAndParseValue('inflationRate', 2, true);
        console.log(`Inflation rate: ${inflationRate}`);

        const capitalGainsTaxRate = getAndParseValue('capitalGainsTax', 15, true);
        console.log(`Capital gains tax rate: ${capitalGainsTaxRate}`);

        let resultsHtml = '<div class="results-container">';
        let comparisonResults = {};

        if (document.getElementById('houseScenario') && document.getElementById('houseScenario').checked) {
            console.log('House scenario selected');
            const houseInitialInvestment = getAndParseValue('houseInitialInvestment', 300000);
            const houseInvestmentTerm = getAndParseValue('houseInvestmentTerm', 30);
            const houseValue = getAndParseValue('houseValue', 1500000);
            const mortgageRate = getAndParseValue('mortgageRate', 5, true);
            const annualInsurance = getAndParseValue('annualInsurance', 3000);
            const annualRates = getAndParseValue('annualRates', 2000);
            const annualMaintenance = getAndParseValue('annualMaintenance', 1, true);
            const houseCagr = getAndParseValue('houseCagr', 5, true);

            console.log('House scenario values:', { 
                houseInitialInvestment, houseInvestmentTerm, houseValue, 
                mortgageRate, annualInsurance, annualRates, 
                annualMaintenance, houseCagr 
            });

const houseResults = calculateHouseInvestment(
                houseInitialInvestment, houseValue, mortgageRate, houseInvestmentTerm, 
                annualInsurance, annualRates, annualMaintenance, 
                inflationRate, capitalGainsTaxRate, houseCagr
            );
            
            const houseLowCagr = calculateHouseInvestment(
                houseInitialInvestment, houseValue, mortgageRate, houseInvestmentTerm, 
                annualInsurance, annualRates, annualMaintenance, 
                inflationRate, capitalGainsTaxRate, Math.max(0, houseCagr - 0.02)
            );
            
            const houseHighCagr = calculateHouseInvestment(
                houseInitialInvestment, houseValue, mortgageRate, houseInvestmentTerm, 
                annualInsurance, annualRates, annualMaintenance, 
                inflationRate, capitalGainsTaxRate, houseCagr + 0.02
            );

            console.log('House investment results:', { houseResults, houseLowCagr, houseHighCagr });

                
    resultsHtml += `
        <div class="result-card">
            <h3>House Investment</h3>
            <table>
                <tr><td>Monthly Mortgage Payment:</td><td>${formatCurrency(houseResults.monthlyMortgage)}</td></tr>
                <tr><td>Total Mortgage Cost:</td><td>${formatCurrency(houseResults.totalMortgageCost)}</td></tr>
                <tr><td>Total Insurance Cost:</td><td>${formatCurrency(houseResults.totalInsurance)}</td></tr>
                <tr><td>Total Rates Cost:</td><td>${formatCurrency(houseResults.totalRates)}</td></tr>
                <tr><td>Total Maintenance Cost:</td><td>${formatCurrency(houseResults.totalMaintenance)}</td></tr>
                <tr><td>Capital Gains Tax:</td><td>${formatCurrency(houseResults.capitalGainsTax)}</td></tr>
                <tr><td>Final House Value (Nominal):</td><td>${formatCurrency(houseResults.finalHouseValue)}</td></tr>
                <tr><td>Final House Value (Real):</td><td>${formatCurrency(houseResults.realFinalHouseValue)}</td></tr>
                <tr><td>Net Profit (Nominal):</td><td>${formatCurrency(houseResults.nominalNetProfit)}</td></tr>
                <tr><td>Net Profit (Real):</td><td>${formatCurrency(houseResults.realNetProfit)}</td></tr>
                <tr><td colspan="2"><strong>CAGR Spread Results:</strong></td></tr>
                <tr><td>Low CAGR (${formatPercentage(houseCagr - 0.02)}):</td><td></td></tr>
                <tr><td>- Net Profit (Nominal):</td><td>${formatCurrency(houseLowCagr.nominalNetProfit)}</td></tr>
                <tr><td>- Net Profit (Real):</td><td>${formatCurrency(houseLowCagr.realNetProfit)}</td></tr>
                <tr><td>High CAGR (${formatPercentage(houseCagr + 0.02)}):</td><td></td></tr>
                <tr><td>- Net Profit (Nominal):</td><td>${formatCurrency(houseHighCagr.nominalNetProfit)}</td></tr>
                <tr><td>- Net Profit (Real):</td><td>${formatCurrency(houseHighCagr.realNetProfit)}</td></tr>
            </table>
        </div>
    `;

    comparisonResults['House'] = {
                    initialInvestment: houseInitialInvestment,
                    finalValue: houseResults.finalHouseValue,
                    totalCosts: houseResults.totalHouseCosts + houseResults.capitalGainsTax,
                    nominalProfit: houseResults.nominalNetProfit,
                    realProfit: houseResults.realNetProfit
                };
            }
 if (document.getElementById('bitcoinScenario') && document.getElementById('bitcoinScenario').checked) {
                const bitcoinInitialInvestment = parseFloat(document.getElementById('bitcoinInitialInvestment').value);
                const bitcoinInvestmentTerm = parseInt(document.getElementById('bitcoinInvestmentTerm').value);
                const bitcoinPrice = parseFloat(document.getElementById('bitcoinPrice').value);
                const weeklyRent = parseFloat(document.getElementById('weeklyRent').value);
                const bitcoinCagr = parseFloat(document.getElementById('bitcoinCagr').value) / 100;
                const isDCA = document.getElementById('bitcoinInvestmentType').value === 'dca';
                const dcaAmount = isDCA ? parseFloat(document.getElementById('dcaAmount').value) : 0;
                const dcaFrequency = isDCA ? document.getElementById('dcaFrequency').value : 'weekly';
                const dcaTerm = isDCA ? parseInt(document.getElementById('dcaTerm').value) : bitcoinInvestmentTerm;

                const bitcoinResults = calculateBitcoinInvestment(
                    bitcoinInitialInvestment,
                    bitcoinPrice,
                    bitcoinCagr,
                    bitcoinInvestmentTerm,
                    weeklyRent,
                    inflationRate,
                    capitalGainsTaxRate,
                    isDCA,
                    dcaAmount,
                    dcaFrequency,
                    dcaTerm
                );

                const bitcoinLowCagr = calculateBitcoinInvestment(
                    bitcoinInitialInvestment,
                    bitcoinPrice,
                    Math.max(0, bitcoinCagr - 0.05),
                    bitcoinInvestmentTerm,
                    weeklyRent,
                    inflationRate,
                    capitalGainsTaxRate,
                    isDCA,
                    dcaAmount,
                    dcaFrequency,
                    dcaTerm
                );

                const bitcoinHighCagr = calculateBitcoinInvestment(
                    bitcoinInitialInvestment,
                    bitcoinPrice,
                    bitcoinCagr + 0.05,
                    bitcoinInvestmentTerm,
                    weeklyRent,
                    inflationRate,
                    capitalGainsTaxRate,
                    isDCA,
                    dcaAmount,
                    dcaFrequency,
                    dcaTerm
                );

        resultsHtml += `
            <div class="result-card">
                <h3>Bitcoin Investment</h3>
                <table>
                    <tr><td>Investment Type:</td><td>${isDCA ? 'Dollar-Cost Averaging' : 'Lump Sum'}</td></tr>
                    <tr><td>Total Invested:</td><td>${formatCurrency(bitcoinResults.totalInvested)}</td></tr>
                    <tr><td>Bitcoins Purchased:</td><td>${formatNumber(bitcoinResults.bitcoinsPurchased)}</td></tr>
                    <tr><td>Future Bitcoin Value:</td><td>${formatCurrency(bitcoinResults.futureValue)}</td></tr>
                    <tr><td>Total Rent Cost:</td><td>${formatCurrency(bitcoinResults.totalRentCost)}</td></tr>
                    <tr><td>Capital Gains Tax:</td><td>${formatCurrency(bitcoinResults.capitalGainsTax)}</td></tr>
                    <tr><td>Net Profit:</td><td>${formatCurrency(bitcoinResults.nominalProfit)}</td></tr>
                    <tr><td colspan="2"><strong>CAGR Spread Results:</strong></td></tr>
                    <tr><td>Low CAGR (${formatPercentage(bitcoinCagr - 0.05)}) Net Profit:</td><td>${formatCurrency(bitcoinLowCagr.nominalProfit)}</td></tr>
                    <tr><td>High CAGR (${formatPercentage(bitcoinCagr + 0.05)}) Net Profit:</td><td>${formatCurrency(bitcoinHighCagr.nominalProfit)}</td></tr>
                </table>
                <p>Note 1) Bitcoin is considered <strong>inflation-resistant</strong>, which means its purchasing power is assumed to remain constant relative to goods and services over time, regardless of inflation in fiat currencies. This is why the nominal and real profits are the same for Bitcoin in this model.</p>
                <p>Note 2) Capital gains tax can significantly impact Bitcoin investment returns. Always consult with a tax professional for accurate tax implications.</p>
            </div>
        `;

       comparisonResults['Bitcoin'] = {
                    initialInvestment: bitcoinResults.totalInvested,
                    finalValue: bitcoinResults.futureValue,
                    totalCosts: bitcoinResults.totalRentCost + bitcoinResults.capitalGainsTax,
                    nominalProfit: bitcoinResults.nominalProfit,
                    realProfit: bitcoinResults.realProfit,
                    lowCagrProfit: bitcoinLowCagr.nominalProfit,
                    highCagrProfit: bitcoinHighCagr.nominalProfit
                };
            }

          if (document.getElementById('termDepositScenario') && document.getElementById('termDepositScenario').checked) {
            const termDepositInitialInvestment = parseFloat(document.getElementById('termDepositInitialInvestment').value);
            const termDepositTerm = parseInt(document.getElementById('termDepositTerm').value);
            const termDepositRate = parseFloat(document.getElementById('termDepositRate').value) / 100;
            const termDepositTaxRate = parseFloat(document.getElementById('termDepositTaxRate').value) / 100;
            
            const termDepositResults = calculateTermDeposit(
                termDepositInitialInvestment, 
                termDepositRate, 
                termDepositTaxRate, 
                termDepositTerm, 
                inflationRate
            );

            resultsHtml += `
                <div class="result-card">
                    <h3>Term Deposit Investment</h3>
                    <table>
                        <tr><td>Initial Investment:</td><td>${formatCurrency(termDepositInitialInvestment)}</td></tr>
                        <tr><td>Investment Term:</td><td>${termDepositTerm} years</td></tr>
                        <tr><td>Final Balance:</td><td>${formatCurrency(termDepositResults.finalBalance)}</td></tr>
                        <tr><td>Total Interest Earned:</td><td>${formatCurrency(termDepositResults.totalInterestEarned)}</td></tr>
                        <tr><td>Total Tax Paid:</td><td>${formatCurrency(termDepositResults.totalTaxPaid)}</td></tr>
                        <tr><td>Nominal Profit (After Tax):</td><td>${formatCurrency(termDepositResults.nominalProfit)}</td></tr>
                        <tr><td>Real Profit (Inflation Adjusted):</td><td>${formatCurrency(termDepositResults.realProfit)}</td></tr>
                    </table>
                </div>
            `;

            comparisonResults['Term Deposit'] = {
                initialInvestment: termDepositInitialInvestment,
                finalValue: termDepositResults.finalBalance,
                totalCosts: termDepositResults.totalTaxPaid,
                nominalProfit: termDepositResults.nominalProfit,
                realProfit: termDepositResults.realProfit
            };
        }

      if (document.getElementById('loan4bitcoinScenario') && document.getElementById('loan4bitcoinScenario').checked) {
    const bitcoinLoanAmount = parseFloat(document.getElementById('bitcoinLoanAmount').value);
    const bitcoinLoanRate = parseFloat(document.getElementById('bitcoinLoanRate').value) / 100;
    const bitcoinLoanTerm = parseInt(document.getElementById('bitcoinLoanTerm').value);
    const bitcoinPrice = parseFloat(document.getElementById('bitcoinPrice').value);
    const bitcoinCagr = parseFloat(document.getElementById('bitcoinCagr').value) / 100;

    const loan4bitcoinResults = calculateLoan4Bitcoin(bitcoinLoanAmount, bitcoinPrice, bitcoinCagr, bitcoinLoanTerm, bitcoinLoanRate, inflationRate, capitalGainsTaxRate);
    const loan4bitcoinLowCagr = calculateLoan4Bitcoin(bitcoinLoanAmount, bitcoinPrice, Math.max(0, bitcoinCagr - 0.05), bitcoinLoanTerm, bitcoinLoanRate, inflationRate, capitalGainsTaxRate);
    const loan4bitcoinHighCagr = calculateLoan4Bitcoin(bitcoinLoanAmount, bitcoinPrice, bitcoinCagr + 0.05, bitcoinLoanTerm, bitcoinLoanRate, inflationRate, capitalGainsTaxRate);

    resultsHtml += `
        <div class="result-card">
            <h3>Loan4Bitcoin Investment</h3>
            <table>
                <tr><td>Bitcoins Purchased:</td><td>${formatNumber(loan4bitcoinResults.bitcoinsPurchased)}</td></tr>
                <tr><td>Future Bitcoin Value:</td><td>${formatCurrency(loan4bitcoinResults.futureValue)}</td></tr>
                <tr><td>Total Loan Cost:</td><td>${formatCurrency(loan4bitcoinResults.totalLoanCost)}</td></tr>
                <tr><td>Capital Gains Tax:</td><td>${formatCurrency(loan4bitcoinResults.capitalGainsTax)}</td></tr>
                <tr><td>Profit:</td><td>${formatCurrency(loan4bitcoinResults.profit)}</td></tr>
                <tr><td colspan="2"><strong>CAGR Spread Results:</strong></td></tr>
                <tr><td>Low CAGR (${formatPercentage(bitcoinCagr - 0.05)}) Profit:</td><td>${formatCurrency(loan4bitcoinLowCagr.profit)}</td></tr>
                <tr><td>High CAGR (${formatPercentage(bitcoinCagr + 0.05)}) Profit:</td><td>${formatCurrency(loan4bitcoinHighCagr.profit)}</td></tr>
            </table>
            <p>Note: Bitcoin is considered inflation-resistant, so the profit is not adjusted for inflation.</p>
        </div>
    `;

    comparisonResults['Loan4Bitcoin'] = {
        initialInvestment: bitcoinLoanAmount,
        finalValue: loan4bitcoinResults.futureValue,
        totalCosts: loan4bitcoinResults.totalLoanCost + loan4bitcoinResults.capitalGainsTax,
        nominalProfit: loan4bitcoinResults.profit,
        realProfit: loan4bitcoinResults.profit,  // Same as nominal profit
        lowCagrProfit: loan4bitcoinLowCagr.profit,
        highCagrProfit: loan4bitcoinHighCagr.profit
    };
}
  resultsHtml += generateComparisonTable(comparisonResults);
        resultsHtml += '</div>';

        const resultsElement = document.getElementById('results');
        if (resultsElement) {
            resultsElement.innerHTML = resultsHtml;
            const resultsCard = document.getElementById('resultsCard');
            if (resultsCard) {
                resultsCard.style.display = 'block';
            }
        } else {
            console.error('Results element not found');
        }

    } catch (error) {
        console.error('Error in calculate function:', error);
        const resultsElement = document.getElementById('results');
        if (resultsElement) {
            resultsElement.innerHTML = `<p class="error">An error occurred: ${error.message}</p>`;
            const resultsCard = document.getElementById('resultsCard');
            if (resultsCard) {
                resultsCard.style.display = 'block';
            }
        } else {
            console.error('Results element not found');
        }
    }
}
function toggleBitcoinInputs() {
    const investmentType = document.getElementById('bitcoinInvestmentType');
    const lumpsumInputs = document.getElementById('lumpsumInputs');
    const dcaInputs = document.getElementById('dcaInputs');
    
    if (!investmentType || !lumpsumInputs || !dcaInputs) {
        console.warn("Some Bitcoin input elements are missing");
        return;
    }
    
    const isDCA = investmentType.value === 'dca';
    lumpsumInputs.style.display = isDCA ? 'none' : 'block';
    dcaInputs.style.display = isDCA ? 'block' : 'none';
}
function toggleScenarioVisibility() {
    const houseCard = document.getElementById('houseCard');
    const bitcoinCard = document.getElementById('bitcoinCard');
    const termDepositScenario = document.getElementById('termDepositScenario');
    const houseScenario = document.getElementById('houseScenario');
    const bitcoinScenario = document.getElementById('bitcoinScenario');
    const termDepositScenarioCheckbox = document.getElementById('termDepositScenario');

    if (!houseCard || !bitcoinCard || !termDepositScenario || !houseScenario || !bitcoinScenario || !termDepositScenarioCheckbox) {
        console.warn("Some scenario elements are missing");
        return;
    }

    houseCard.style.display = houseScenario.checked ? 'block' : 'none';
    bitcoinCard.style.display = bitcoinScenario.checked ? 'block' : 'none';
    termDepositScenario.style.display = termDepositScenarioCheckbox.checked ? 'block' : 'none';
}

function toggleLoan4BitcoinInputs() {
    const loan4bitcoinScenario = document.getElementById('loan4bitcoinScenario');
    const inputsElement = document.getElementById('loan4bitcoinInputs');
    if (!loan4bitcoinScenario || !inputsElement) {
        console.warn("Loan4Bitcoin elements are missing");
        return;
    }
    inputsElement.style.display = loan4bitcoinScenario.checked ? 'block' : 'none';
    calculate();
}

function toggleResultsVisibility(show) {
    const resultsCard = document.getElementById('resultsCard');
    if (resultsCard) {
        resultsCard.style.display = show ? 'block' : 'none';
    }
}


function initializeEventListeners() {
    // Helper function to safely add event listener
    function addListener(id, event, handler) {
        const element = document.getElementById(id);
        if (element) {
            element.addEventListener(event, handler);
        } else {
            console.warn(`Element with id '${id}' not found`);
        }
    }

    // Helper function to sync inputs
    function setupSync(id) {
        syncInputs(id + 'Slider', id);
    }


    // Setup Bitcoin investment type change
    addListener('bitcoinInvestmentType', 'change', function() {
        toggleBitcoinInputs();
        const isDCA = this.value === 'dca';
        const dcaInputs = document.getElementById('dcaInputs');
        if (dcaInputs) {
            dcaInputs.style.display = isDCA ? 'block' : 'none';
        }
    });

    // Setup scenario visibility toggles
    ['houseScenario', 'bitcoinScenario', 'termDepositScenario'].forEach(id => {
        addListener(id, 'change', toggleScenarioVisibility);
    });

      // Setup input syncing
    const allInputIds = [
        'houseValue', 'mortgageRate', 'annualInsurance',
        'annualRates', 'annualMaintenance', 'bitcoinPrice', 'weeklyRent', 'houseCagr', 'bitcoinCagr',
        'termDepositRate', 'termDepositTaxRate', 'capitalGainsTax', 'inflationRate',
        'bitcoinInitialInvestment', 'dcaAmount', 'houseInitialInvestment', 'houseInvestmentTerm', 
        'bitcoinInitialInvestment', 'bitcoinInvestmentTerm', 'dcaTerm', 'bitcoinLoanAmount', 
        'bitcoinLoanRate', 'bitcoinLoanTerm', 'termDepositInitialInvestment', 'termDepositTerm'
    ];
    allInputIds.forEach(setupSync);


    // Setup other event listeners
    addListener('applyTax', 'change', calculate);
    addListener('loan4bitcoinScenario', 'change', toggleLoan4BitcoinInputs);
    addListener('dcaFrequency', 'change', calculate);
    addListener('calculateButton', 'click', calculate);
}
function initializeCalculator() {
    const requiredElements = [
        'bitcoinInvestmentType', 'houseCard', 'bitcoinCard', 'termDepositScenario',
        'houseScenario', 'bitcoinScenario', 'termDepositScenario',
        'loan4bitcoinScenario', 'loan4bitcoinInputs', 'calculateButton', 'results'
    ];
    
    const missingElements = requiredElements.filter(id => !document.getElementById(id));
    
    if (missingElements.length > 0) {
        console.error("Missing elements:", missingElements);
        return;
    }

    initializeEventListeners();
    toggleScenarioVisibility();
    toggleBitcoinInputs();

    const calculateButton = document.getElementById('calculateButton');
    if (calculateButton) {
        console.log('Calculate button found, attaching event listener');
        calculateButton.addEventListener('click', function(event) {
            console.log('Calculate button clicked');
            calculate();
        });
    } else {
        console.error("Calculate button not found");
    }
}

// Wrap the initialization in a DOMContentLoaded event listener
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM fully loaded and parsed');
    initializeCalculator();
});

console.log('Investment calculator script loaded');
  </script>
</body>
</html>
